/* hacktv - Analogue video transmitter for the HackRF                    */
/*=======================================================================*/
/* Copyright 2017 Philip Heron <phil@sanslogic.co.uk>                    */
/*                                                                       */
/* This program is free software: you can redistribute it and/or modify  */
/* it under the terms of the GNU General Public License as published by  */
/* the Free Software Foundation, either version 3 of the License, or     */
/* (at your option) any later version.                                   */
/*                                                                       */
/* This program is distributed in the hope that it will be useful,       */
/* but WITHOUT ANY WARRANTY; without even the implied warranty of        */
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         */
/* GNU General Public License for more details.                          */
/*                                                                       */
/* You should have received a copy of the GNU General Public License     */
/* along with this program.  If not, see <http://www.gnu.org/licenses/>. */

#include "videocrypt.h"

/* Blocks for VC1 free-access decoding */
static _vc_block_t   _fa_blocks[] = { { 0x05, VC_PRBS_CW_FA } };

/* Blocks for VC2 free-access decoding */
static _vc2_block_t _fa2_blocks[] = { { 0x9C, VC_PRBS_CW_FA } };

static _vc_block_t _sky03_blocks[] = {
	{
		0x07, 0,
		{
 			{ 0x20 },
 			{ }, { }, { }, { },
 			{ 0xD8,0x01 },
		},
	},
	{
		0x07, 0,
		{
 			{ 0x20,0x00,0x77,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x20,0x53,0x4B,0x59,0x30,0x33,0x20,0x4D,0x4F,0x44,0x45 },
 			{ }, { }, { }, { },
 			{ 0xD8,0x01 },
		},
	},
};

static _vc_block_t _sky05_blocks_sky_movies[] = {
	{
		0x07, 1,
		{
 			{ 0x20 },
 			{ }, { }, { }, { },
 			{ 0xC8,0x1B,0x7C,0x00,0x1E,0x5F,0x42,0x4B,0x5F,0xAF,0x5C,0x1D,0x83,0x8E,0x9D,0xAA,0xDB,0xDB,0xDB,0xDB,0xDB,0xDB,0xDB,0xDB,0xDB,0xDB,0xDB,0xAB,0xFF,0x70,0xBF,0x76 },
		},
	},
	{
		0x07, 1,
		{
 			{ 0x20,0x00,0x77,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x20,0x53,0x4B,0x59,0x30,0x35,0x20,0x4D,0x4F,0x44,0x45 },
 			{ }, { }, { }, { },
 			{ 0xC8,0x1B,0x7C,0x00,0x93,0x09,0x42,0x4B,0x5F,0xAE,0xC7,0x2D,0x9E,0xA8,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0x56,0xA8,0x3C,0xB1,0xA4 },
		},
	},
};

/* Sample taken from Sky One on October 1991 */
static _vc_block_t _sky05_blocks[] = {
	{
		0x07, 0xC9BDE47533F8E7CB,
		{
 			{ 0x20 },
 			{ }, { }, { }, { },
 			{ 0xE8,0x1B,0x7E,0x20,0xAD,0x16,0x01,0x77,0xF0,0x6F,0x35,0x85,0x85,0x85,0x85,0x85,0x85,0x85,0x85,0x85,0x85,0x85,0x85,0x85,0x85,0x85,0x85,0x54,0xB4,0xFB,0x3D,0x00 },
		},
	},
	{
		0x07, 0x1845E6DBC3F0BE79,
		{
 			{ 0x20,0x00,0x77,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x20,0x53,0x4B,0x59,0x30,0x35,0x20,0x4D,0x4F,0x44,0x45 },
 			{ }, { }, { }, { },
 			{ 0xE8,0x1B,0x7E,0x20,0x87,0x1E,0x01,0x77,0xF0,0x6E,0xD2,0x7F,0xDD,0xDD,0xDD,0xDD,0xDD,0xDD,0xDD,0xDD,0xDD,0xDD,0xDD,0xDD,0xDD,0xDD,0xDD,0x32,0x66,0x3D,0xD7,0xF4 },
		},
	},
};

static _vc_block_t _sky05_blocks_sky_sports[] = {
	{
		0x07, 1,
		{
 			{ 0x20 },
 			{ }, { }, { }, { },
 			{ 0xC8,0x1B,0x9C,0x00,0xB7,0x5C,0x00,0x95,0xD3,0x86,0x35,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x35,0x82,0x45,0x80,0xCF },
		},
	},
	{
		0x07, 1,
		{
 			{ 0x20,0x00,0x77,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x20,0x53,0x4B,0x59,0x30,0x35,0x20,0x4D,0x4F,0x44,0x45 },
 			{ }, { }, { }, { },
 			{ 0xC8,0x1B,0x9C,0x00,0x81,0x0B,0x00,0x95,0xD3,0x86,0x2C,0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x85,0xE2,0xBB,0xA8,0x91 },
		},
	},
};

static _vc_block_t _sky05_blocks_comedy_channel[] = {
	{
		0x07, 0xCF5217AD71790AE7,
		{
 			{ 0x20 },
 			{ }, { }, { }, { },
 			{ 0xE8,0x1A,0xFE,0x22,0x62,0x0F,0x01,0x6E,0xEC,0xAB,0x82,0x68,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0x93,0x2C,0xC8,0x39,0xD8 },
		},
	},
	{
		0x07, 0xCF5217AD71790AE7,
		{
 			{ 0x20,0x00,0x77,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x20,0x53,0x4B,0x59,0x30,0x35,0x20,0x4D,0x4F,0x44,0x45 },
 			{ }, { }, { }, { },
 			{ 0xE8,0x1A,0xFE,0x22,0x62,0x0F,0x01,0x6E,0xEC,0xAB,0x82,0x68,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0xCB,0x93,0x2C,0xC8,0x39,0xD8 },
		},
	},
};

/* Blocks for VC1 conditional-access sample, taken from Sky Movies and modified, */
/* requires an active Sky 07 card to decode */
static _vc_block_t _sky07_blocks[] = {
	{
		0x07, 0,
		{
 			{ 0x20 },
 			{ }, { }, { }, { },
 			{ 0xE8,0x20,0x3E,0xED,0xF0,0x1C,0x00,0x6F,0xE9,0x06,0xD6 },
		},
	},
	{
		0x07, 0,
		{
 			{ 0x20,0x00,0x77,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x20,0x53,0x4B,0x59,0x30,0x37,0x20,0x4D,0x4F,0x44,0x45 },
 			{ }, { }, { }, { },
 			{ 0xE8,0x20,0x3E,0xED,0xF0,0x1C,0x00,0x6F,0xE9,0x06,0xD6 },
		},
	},
};

/* Blocks for VC1 conditional-access sample, taken from Sky Movies and modified, */
/* requires an active Sky 09 card to decode */
static _vc_block_t _sky09_blocks[] = {
	{
		0x07, 0,
		{
 			{ 0x20 }, 
			 { }, { }, { }, { },
 			{ 0xE8,0x43,0x0A,0x88,0x82,0x61,0x0C,0x29,0xE4,0x03,0xF6 },
		},
	},
	{
		0x07, 0,
		{
 			{ 0x20,0x00,0x77,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x20,0x53,0x4B,0x59,0x30,0x39,0x20,0x4D,0x4F,0x44,0x45 },
 			{ }, { }, { }, { },
 			{ 0xE8,0x43,0x0A,0x88,0x82,0x61,0x0C,0x29,0xE4,0x03,0xF6 },
		},
	},
};

/* Blocks for VC1 conditional-access sample, */
/* requires an active Sky 10 (0A) series card to decode */
static _vc_block_t _sky10_blocks[] = {
	{
		0x07, 0x16DEC6F6FD37145BUL,
		{
 			{ 0x20 },
 			{ }, { }, { }, { },
 			{ 0xF8,0x91,0x45,0x24,0xE9,0xEB,0x8F,0x00,0xE8,0x78,0x86,0x13,0x63,0x92,0xB3,0x14,0x73,0x32,0xBA,0xC3,0xCE,0x7B,0x41,0xE6,0x4B,0x53,0xB7,0x76,0x82,0x8B,0xFD },
		},
	},
	{
		0x07, 0x7DE3581091A306E5UL,
		{
 			{ 0x20,0x00,0x77,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x20,0x53,0x4B,0x59,0x31,0x30,0x20,0x4D,0x4F,0x44,0x45 },
 			{ }, { }, { }, { },
 			{ 0xF8,0x91,0x54,0x24,0x4B,0xFE,0x9F,0xA7,0x26,0x75,0x11,0x65,0xE5,0x11,0x70,0x75,0xDA,0xF1,0x0B,0x99,0x6B,0x95,0x0A,0x53,0xC0,0xCA,0xAE,0x76,0xEF,0x5D,0xD8 },
		},
	},	
};

/* Blocks for VC1 conditional-access sample, taken from Tyson fight and modified, */
/* requires an active Sky 10 (0A) series card with PPV enabled to decode */

/*
This packet sets up credits and events you wish to purchase. The 12h/34h bytes are
the first program/credit pair. The 56h/78h bytes are the second program/credit pair.
The six bytes 01h-06h are the six event numbers to enable.

53 86 01 00 2D 
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 12
34 56 78 01 02 03 04 05 06 00 00 00 00 

For these CWs, the following needs to be sent to the 
card to activate it for event 66.

53 86 01 00 2D
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 42
34 00 00 42 00 00 00 00 00 00 00 00 00 

This packet forces the new Pay Per View
data into the card without authorization.

53 74 01 00 20
C0 8F 40 00 00 2E AB F5 19 26 98 B5 46 77 BB E3
32 12 ED 50 49 FF 57 B7 52 C0 0A 02 02 02 02 02
*/

static _vc_block_t _sky10ppv_blocks[] = {
	{
		0x07, 0x7298D7112703C5D9UL,
		{
 			{ 0x20 },
			/* Packet below removes PPV credits - uncomment at your own risk! */
 			//{ 0xC0,0x8F,0x40,0x00,0x00,0x2E,0xAB,0xF5,0x19,0x26,0x98,0xB5,0x46,0x77,0xBB,0xE3,0x32,0x12,0xED,0x50,0x49,0xFF,0x57,0xB7,0x52,0xC0,0x0A,0x02,0x02,0x02,0x02,0x02 }, 
			/* Comment out below line is above is enabled */
			{ }, { }, { }, { },
 			{ 0xF8,0x94,0x9C,0xF0,0x42,0xE6,0x2F,0x2A,0xB7,0x25,0xBC,0x62,0xD8,0x95,0x1E,0x93,0x7C,0x55,0xB8,0x71,0xD5,0x2F,0x29,0x65,0xA2,0x1E,0x3A,0x63,0xF6,0x59,0xF6 },
		},
	},
	{
		0x07, 0x20222974682EFF97UL,
		{
 			{ 0x20,0x00,0x77,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x53,0x4B,0x59,0x31,0x30,0x20,0x20,0x50,0x50,0x56,0x20,0x4D,0x4F,0x44,0x45 },
 			{ }, { }, { }, { },
			{ 0xF8,0x94,0x8E,0xF0,0x42,0x7E,0x13,0xCC,0x19,0xDD,0x87,0x60,0x5A,0x78,0x61,0x0B,0x66,0x44,0x51,0x87,0xAE,0x01,0xBC,0x4D,0x47,0x31,0x03,0x80,0x7F,0x8D,0x74 },
		},
	},
};

/* Blocks for VC1 conditional-access sample, taken from MTV UK, */
/* requires an active Sky 11 series card to decode */
static _vc_block_t _sky11_blocks[] = {
	{
		0x07, 0xB2DD55A7BCE178EUL,
		{
 			{ 0x20 },
 			{ }, { }, { }, { },
 			{ 0xF8,0x19,0x10,0x83,0x20,0x85,0x60,0xAF,0x8F,0xF0,0x49,0x34,0x86,0xC4,0x6A,0xCA,0xC3,0x21,0x4D,0x44,0xB3,0x24,0x36,0x57,0xEC,0xA7,0xCE,0x12,0x38,0x91,0x3E }
		},
	},
	{
		0x07, 0xF9885DA50770B80UL,
		{
 			{ 0x20,0x00,0x77,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x20,0x53,0x4B,0x59,0x31,0x31,0x20,0x4D,0x4F,0x44,0x45 },
 			{ }, { }, { }, { },
 			{ 0xF8,0x19,0x10,0x83,0x20,0xD1,0xB5,0xA9,0x1F,0x82,0xFE,0xB3,0x6B,0x0A,0x82,0xC3,0x30,0x7B,0x65,0x9C,0xF2,0xBD,0x5C,0xB0,0x6A,0x3B,0x64,0x0F,0xA2,0x66,0xBB }	
		},
	},
};

/* Blocks for VC1 conditional-access sample, taken from Sky One, */
/* requires an active Sky 12 series card to decode */
static _vc_block_t _sky12_blocks[] = {
	{
		0x07, 0xC73805F6EF5A1AAB,
		{
 			{ 0x20 },
 			{ }, { }, { }, { },
 			{ 0xE8,0xCD,0xA7,0x83,0xD1,0x21,0xE5,0x42,0x30,0xF1,0x09,0xBD,0x74,0xB5,0x24,0xC5,0xBF,0x62,0x08,0x1F,0x43,0xE9,0x17,0xA9,0x69,0xE0,0xF6,0x3A,0x35,0x88,0x61 }
		},
	},
	{
		0x07, 0xC389AED26500336B,
		{
 			{ 0x20,0x00,0x77,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x20,0x53,0x4B,0x59,0x31,0x32,0x20,0x4D,0x4F,0x44,0x45 },
 			{ }, { }, { }, { },
 			{ 0xE8,0xCD,0xA7,0x83,0xD1,0x31,0x3F,0xF3,0xB5,0x71,0x01,0x9C,0xF9,0xAE,0xB9,0x8D,0x9C,0x19,0xB1,0x75,0xFA,0xCC,0x90,0x33,0x1E,0xDC,0x38,0xCA,0x58,0x10,0xFA }
		},
	},
};

/* Sequence for Conditional-access sample, taken from The Adult Channel and modified. */
/* Requires a PIC16F84 based card flashed with supplied hex file or an active TAC card. */
static _vc_block_t _tac_blocks[] = {
	{
		0x07, 0,
		{
		 	{ 0x20 },
 			{ }, { }, { }, { },
 			{ 0xE8,0x49,0x09,0x92,0x1F,0x93,0x20,0x74,0xCE,0x62,0xE4 },
			{ },
		}
	},
	{
		0x07, 0,
		{
			{ 0x20,0x00,0x76,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x20,0x20,0x54,0x41,0x43,0x20,0x4D,0x4F,0x44,0x45 },
 			{ }, { }, { }, { },
 			{ 0xE8,0x49,0x09,0x92,0x1F,0x93,0x20,0x74,0xCE,0x62,0xE4 },
			{ },
		}
	},
};

static _vc_block_t _xtea_blocks[] = {
	{
		0x07, 0x1A298F7C70F4F65UL,
		{
			{ 0x20 },
			{ }, { }, { }, { },
			{ 0xE8,0x49,0x09,0x92,0x1F,0x93,0x20,0x74,0xCE,0x62,0xE4,0xEA,0xB3,0xB3,0xBF,0x8A,0xE3,0xDF,0x26,0x99,0x5E,0x2F,0x0B,0xFB,0x8E,0x45,0x22,0x94,0x4A,0x1A,0x8E }
		}
	},
	{
		0x07, 0xD491B336D3D54BAUL,
		{
			{ 0x20,0x00,0x79,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x54,0x41,0x43,0x2F,0x58,0x54,0x45,0x41,0x20,0x4D,0x4F,0x44,0x45 },
			{ }, { }, { }, { },
			{ 0xE8,0x49,0x09,0x92,0x1F,0x93,0x20,0x74,0xCE,0x62,0xE4,0xD5,0x04,0x5E,0x8E,0x54,0x91,0x58,0xFF,0x44,0x32,0x72,0xBB,0xEF,0x29,0x8E,0x3C,0x98,0x41,0xD1,0x33 }
		}
	},
};

/* Blocks for VC2 conditional-access sample, taken from Discovery Channel. */
/* Requires a PIC16F84 based card flashed with supplied hex file or an active Multichoice card.*/
static _vc2_block_t _vc2_blocks[] = {
	{
		0xA0, 0,
		{
			{ 0x21,0x02,0x6B,0x4D,0x55,0x4C,0x54,0x49,0x43,0x48,0x4F,0x49,0x43,0x45},
			{ 0xE1 }, { 0xE1 }, { 0xE1 }, { 0xE1 },
			{ 0xF9,0x52,0x80,0x80,0x04,0xF7,0xB7 },
		}
	},
	{
		0xA0, 0,
		{
			{ 0x21,0x02 },
			{ 0xE1 }, { 0xE1 },
			{ 0xE1 }, { 0xE1 },
			{ 0xF9,0x52,0x80,0x80,0x04,0xF7,0xB7 },
		}
	},
};

/* Blocks used in PPV/memory card mode */
static _vc_block_t _ppv_blocks[] = {
	{
		0x07, 0,
		{
			{
				0xA8,
				0x04,      /* Pay-view                 */
				0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
				0x11,0x00, /* Program number (12 bits) */
				0x00,      /* PPV program rate         */
				0x00,      /* PPV min rate             */
			},
		},
	},
	{
		0x07, 0,
		{
			{
				0xA8,
				0x08,      /* Pay-view + free-view     */
				0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
				0x11,0x00, /* Program number (12 bits) */
				0x00,      /* PPV program rate         */
				0x00,      /* PPV min rate             */
			},
			{ 0x20,0x00,0x76,0x20,0x20,0x20,0x48,0x41,0x43,0x4B,0x54,0x56,0x20,0x20,0x20,0x20,0x20,0x50,0x50,0x56,0x20,0x4D,0x4F,0x44,0x45 },
		}
	}
};
